<section class="services" [formGroup]="form">
  <div class="section-header">
    <div>
      <h1>Services</h1>
      <p class="muted">Configure providers, OAuth clients, and backups.</p>
    </div>
    <div class="actions">
      <button pButton type="button" icon="pi pi-refresh" label="Reload" (click)="load()" [disabled]="loading()" severity="secondary"></button>
      <button pButton type="button" icon="pi pi-save" label="Save" [loading]="saving()" [disabled]="loading()" (click)="save()"></button>
    </div>
  </div>

  @if (error()) {
    <p-message severity="error" [text]="error() ?? ''" styleClass="w-full"></p-message>
  }

  @if (loading()) {
    <p class="muted">Loading service settingsâ€¦</p>
  } @else {
    <div class="layout">
      <aside class="nav">
        <p-listbox
          [options]="navItems"
          optionLabel="label"
          optionValue="value"
          [(ngModel)]="active"
          [ngModelOptions]="{ standalone: true }">
        </p-listbox>
      </aside>

      <div class="content">
        @if (active === 'oauth') {
          <p-card header="OAuth Providers" subheader="Configure Google and GitHub">
            <app-services-oauth-section [googleGroup]="oauthGoogleGroup" [githubGroup]="oauthGithubGroup"></app-services-oauth-section>
          </p-card>
        }
        @if (active === 'memory') {
          <p-card header="Memory" subheader="Embedding and vector store settings">
            <app-services-memory-section [group]="memoryGroup"></app-services-memory-section>
          </p-card>
        }
        @if (active === 'search') {
          <p-card header="Search" subheader="Web search provider (Brave or compatible)">
            <app-services-search-section [group]="searchGroup"></app-services-search-section>
          </p-card>
        }
        @if (active === 'geocoding') {
          <p-card header="Geocoding" subheader="OpenStreetMap Nominatim">
            <app-services-geocoding-section [group]="geocodingGroup"></app-services-geocoding-section>
          </p-card>
        }
        @if (active === 'weather') {
          <p-card header="Weather" subheader="Weather API settings">
            <app-services-weather-section [group]="weatherGroup" [units]="units"></app-services-weather-section>
          </p-card>
        }
        @if (active === 'backups') {
          <p-card header="Backups" subheader="Auto-backup after settings changes">
            <app-services-backups-section [group]="backupsGroup"></app-services-backups-section>
          </p-card>
        }
      </div>
    </div>
  }
</section>
