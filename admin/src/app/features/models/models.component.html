<section class="models">
  <div class="section-header">
    <div>
      <h1>Models</h1>
      <p class="muted">Choose harness models and default call options.</p>
    </div>
    <div class="actions">
      <button pButton type="button" label="Reload" icon="pi pi-refresh" (click)="load()" [disabled]="loading()" severity="secondary"></button>
      <button pButton type="button" label="Save" icon="pi pi-save" (click)="save()" [loading]="saving()" [disabled]="loading()"></button>
    </div>
  </div>

  @if (error()) {
    <p-message severity="error" [text]="error() ?? ''" styleClass="w-full"></p-message>
  }

  @if (loading()) {
    <p class="muted">Loading model settingsâ€¦</p>
  } @else {
    <form [formGroup]="form">
      <div class="cards">
        @for (category of categories; track category.key) {
          <p-card [header]="category.label" [subheader]="category.description">
            <div [formGroupName]="category.key">
              <div class="field">
                <label class="label">Primary model</label>
                <p-autoComplete
                  formControlName="primary"
                  [suggestions]="filteredOptions()"
                  (completeMethod)="filter($event)"
                  [dropdown]="true"
                  placeholder="openrouter/model-id">
                </p-autoComplete>
              </div>

              <div class="field">
                <label class="label">Fallback models</label>
                <p-autoComplete
                  formControlName="fallbacks"
                  [suggestions]="filteredOptions()"
                  (completeMethod)="filter($event)"
                  [multiple]="true"
                  [dropdown]="true"
                  placeholder="Add fallbacks">
                </p-autoComplete>
              </div>

              <div class="grid two-col">
                <label class="field">
                  <span class="label">Temperature</span>
                  <input pInputText type="number" step="0.1" min="0" max="2" formControlName="temperature" />
                </label>
                <label class="field">
                  <span class="label">Top P</span>
                  <input pInputText type="number" step="0.05" min="0" max="1" formControlName="topP" />
                </label>
                <label class="field">
                  <span class="label">Max tokens</span>
                  <input pInputText type="number" min="1" formControlName="maxTokens" />
                </label>
              </div>

              <label class="field">
                <span class="label">Base URL (optional)</span>
                <input pInputText type="text" formControlName="baseUrl" placeholder="https://openrouter.ai/api/v1" />
              </label>

              <label class="field">
                <span class="label">API key (optional)</span>
                <input pInputText type="password" formControlName="apiKey" placeholder="sk-****" />
              </label>
            </div>
          </p-card>
        }
      </div>
    </form>
  }
</section>
